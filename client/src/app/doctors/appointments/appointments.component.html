<section class="content">
  <div class="container-fluid">
    <div class="row clearfix">
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <div class="card">
          <div class="header">
            <h2 translate><strong>Manage</strong> Appointments</h2>
          </div>
          <div class="body">
            <mat-tab-group (selectedTabChange)="tabClick($event)">
              <mat-tab label="Clinic1">
                <br />
                <div class="col-lg-12" *ngIf="clinic1Flag">
                  <span *ngIf="getAppointments.length > 0">
                    <button mat-raised-button color="primary" class="lh-base">
                      {{ getAppointments.length }}
                    </button>
                    Appointments Found</span
                  >
                  <div
                    class="alert alert-danger"
                    role="alert"
                    *ngIf="getAppointmentsflag"
                  >
                    No Appointment records found...
                  </div>

                  <table
                    *ngIf="getAppointments.length > 0"
                    mat-table
                    [dataSource]="dataSource"
                    multiTemplateDataRows
                    class="mat-elevation-z8"
                  >
                    <ng-container
                      matColumnDef="{{ column }}"
                      *ngFor="let column of columnsToDisplay; i as index"
                    >
                      <th
                        mat-header-cell
                        *matHeaderCellDef
                        class="text-capitalize fw-bold"
                      >
                        {{ column }}
                      </th>
                      <td mat-cell *matCellDef="let element">
                        <span *ngIf="column == 'doctorName'">
                          Dr. {{ element.doctorName }}
                        </span>

                        <span *ngIf="column == 'bookedDate'"
                          >{{ element.bookedDate }} - {{ element.bookedDay }} -
                          {{ element.slot }}</span
                        >
                        <span *ngIf="column == 'AppointmentStatus'"
                          ><span
                            class="green"
                            *ngIf="element.AppointmentStatus == 'Closed'"
                            >{{ element.AppointmentStatus }}</span
                          >
                          <span
                            class="red"
                            *ngIf="element.AppointmentStatus == 'Booked'"
                            >{{ element.AppointmentStatus }}</span
                          >
                        </span>
                      </td>
                    </ng-container>
                    <ng-container matColumnDef="expand">
                      <th
                        mat-header-cell
                        *matHeaderCellDef
                        aria-label="row actions"
                      >
                        &nbsp;
                      </th>
                      <td mat-cell *matCellDef="let element">
                        <button
                          mat-icon-button
                          aria-label="expand row"
                          (click)="
                            expandedElement =
                              expandedElement === element ? null : element;
                            $event.stopPropagation()
                          "
                        >
                          <mat-icon *ngIf="expandedElement !== element"
                            >keyboard_arrow_down</mat-icon
                          >
                          <mat-icon *ngIf="expandedElement === element"
                            >keyboard_arrow_up</mat-icon
                          >
                        </button>
                      </td>
                    </ng-container>

                    <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
                    <ng-container matColumnDef="expandedDetail">
                      <td
                        mat-cell
                        *matCellDef="let element"
                        [attr.colspan]="columnsToDisplayWithExpand.length"
                      >
                        <div
                          class="example-element-detail"
                          [@detailExpand]="
                            element == expandedElement
                              ? 'expanded'
                              : 'collapsed'
                          "
                        >
                          <div class="table mb-5">
                            <table class="table lh-lg">
                              <tr>
                                <th scope="row">Doctor Name</th>
                                <td>
                                  Dr. {{ element.doctorName }} -
                                  {{ element.doctorQualification }}
                                </td>
                              </tr>
                              <tr>
                                <th scope="row">Appointment details</th>
                                <td>
                                  {{ element.bookedDate }} -
                                  {{ element.bookedDay }} -
                                  {{ element.slot }}
                                </td>
                              </tr>
                              <tr>
                                <th scope="row">Consulting Fees</th>
                                <td>₹ - {{ element.consultingFees }}</td>
                              </tr>

                              <tr>
                                <th scope="row">Appointment Booked for</th>
                                <td>
                                  {{
                                    element.appointmentFor ? "Others" : "Self"
                                  }}
                                </td>
                              </tr>
                              <tr *ngIf="element.appointmentFor">
                                <th scope="row">Patient details</th>
                                <td>
                                  <p>
                                    Name: {{ element.firstName }}<br />
                                    Mobile: {{ element.primaryMobile }}<br />
                                    Email: {{ element.email }}
                                  </p>
                                </td>
                              </tr>
                              <tr>
                                <th scope="row">Appointment Status</th>
                                <td>
                                  {{ element.AppointmentStatus }}
                                </td>
                              </tr>
                              <tr>
                                <th scope="row">Hospital Address</th>
                                <td>
                                  {{ element.ClinicAddress }}
                                </td>
                              </tr>
                              <tr *ngIf="element.AppointmentStatus == 'Booked'">
                                <td colspan="2">
                                  <button
                                    mat-raised-button
                                    color="primary"
                                    type="button"
                                    (click)="closeAppointment(element._id)"
                                    class="lh-base"
                                  >
                                    Close Appointment
                                  </button>
                                </td>
                              </tr>
                            </table>
                          </div>
                        </div>
                      </td>
                    </ng-container>

                    <tr
                      mat-header-row
                      *matHeaderRowDef="columnsToDisplayWithExpand"
                    ></tr>
                    <tr
                      mat-row
                      *matRowDef="
                        let element;
                        columns: columnsToDisplayWithExpand
                      "
                      class="example-element-row"
                      [class.example-expanded-row]="expandedElement === element"
                      (click)="
                        expandedElement =
                          expandedElement === element ? null : element
                      "
                    ></tr>
                    <tr
                      mat-row
                      *matRowDef="let row; columns: ['expandedDetail']"
                      class="example-detail-row"
                    ></tr>
                  </table>

                  <mat-paginator
                    class="mat-elevation-z8"
                    #paginator
                    [pageSize]="50"
                    showFirstLastButtons
                    [pageSizeOptions]="[20, 50, 100]"
                  >
                  </mat-paginator>
                </div>
              </mat-tab>
              <mat-tab
                label="Clinic2"
                *ngIf="userData?.ClinicTwoTimings.active"
              >
                <br />
                <div class="col-lg-12" *ngIf="clinic2Flag">
                  <span *ngIf="getAppointments.length > 0">
                    <button mat-raised-button color="primary" class="lh-base">
                      {{ getAppointments.length }}
                    </button>
                    Appointments Found</span
                  >
                  <div
                    class="alert alert-danger"
                    role="alert"
                    *ngIf="getAppointmentsflag"
                  >
                    No Appointment records found...
                  </div>
                  <table
                    *ngIf="getAppointments.length > 0"
                    mat-table
                    [dataSource]="dataSource"
                    multiTemplateDataRows
                    class="mat-elevation-z8"
                  >
                    <ng-container
                      matColumnDef="{{ column }}"
                      *ngFor="let column of columnsToDisplay"
                    >
                      <th
                        mat-header-cell
                        *matHeaderCellDef
                        class="text-capitalize fw-bold"
                      >
                        {{ column }}
                      </th>
                      <td mat-cell *matCellDef="let element">
                        <span *ngIf="column == 'doctorName'">
                          Dr. {{ element.doctorName }}
                        </span>

                        <span *ngIf="column == 'bookedDate'"
                          >{{ element.bookedDate }} - {{ element.bookedDay }} -
                          {{ element.slot }}</span
                        >
                        <span *ngIf="column == 'AppointmentStatus'"
                          ><span
                            class="green"
                            *ngIf="element.AppointmentStatus == 'Closed'"
                            >{{ element.AppointmentStatus }}</span
                          >
                          <span
                            class="red"
                            *ngIf="element.AppointmentStatus == 'Booked'"
                            >{{ element.AppointmentStatus }}</span
                          >
                        </span>
                      </td>
                    </ng-container>
                    <ng-container matColumnDef="expand">
                      <th
                        mat-header-cell
                        *matHeaderCellDef
                        aria-label="row actions"
                      >
                        &nbsp;
                      </th>
                      <td mat-cell *matCellDef="let element">
                        <button
                          mat-icon-button
                          aria-label="expand row"
                          (click)="
                            expandedElement =
                              expandedElement === element ? null : element;
                            $event.stopPropagation()
                          "
                        >
                          <mat-icon *ngIf="expandedElement !== element"
                            >keyboard_arrow_down</mat-icon
                          >
                          <mat-icon *ngIf="expandedElement === element"
                            >keyboard_arrow_up</mat-icon
                          >
                        </button>
                      </td>
                    </ng-container>

                    <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
                    <ng-container matColumnDef="expandedDetail">
                      <td
                        mat-cell
                        *matCellDef="let element"
                        [attr.colspan]="columnsToDisplayWithExpand.length"
                      >
                        <div
                          class="example-element-detail"
                          [@detailExpand]="
                            element == expandedElement
                              ? 'expanded'
                              : 'collapsed'
                          "
                        >
                          <div class="table mb-5">
                            <table class="table lh-lg">
                              <tr>
                                <th scope="row">Doctor Name</th>
                                <td>
                                  Dr. {{ element.doctorName }} -
                                  {{ element.doctorQualification }}
                                </td>
                              </tr>
                              <tr>
                                <th scope="row">Appointment details</th>
                                <td>
                                  {{ element.bookedDate }} -
                                  {{ element.bookedDay }} -
                                  {{ element.slot }}
                                </td>
                              </tr>
                              <tr>
                                <th scope="row">Consulting Fees</th>
                                <td>₹ - {{ element.consultingFees }}</td>
                              </tr>

                              <tr>
                                <th scope="row">Appointment Booked for</th>
                                <td>
                                  {{
                                    element.appointmentFor ? "Others" : "Self"
                                  }}
                                </td>
                              </tr>
                              <tr *ngIf="element.appointmentFor">
                                <th scope="row">Patient details</th>
                                <td>
                                  <p>
                                    Name: {{ element.firstName }}<br />
                                    Mobile: {{ element.primaryMobile }}<br />
                                    Email: {{ element.email }}
                                  </p>
                                </td>
                              </tr>
                              <tr>
                                <th scope="row">Appointment Status</th>
                                <td>
                                  {{ element.AppointmentStatus }}
                                </td>
                              </tr>
                              <tr>
                                <th scope="row">Hospital Address</th>
                                <td>
                                  {{ element.ClinicAddress }}
                                </td>
                              </tr>
                              <tr *ngIf="element.AppointmentStatus == 'Booked'">
                                <td colspan="2">
                                  <button
                                    mat-raised-button
                                    color="primary"
                                    type="button"
                                    (click)="closeAppointment(element._id)"
                                    class="lh-base"
                                  >
                                    Close Appointment
                                  </button>
                                </td>
                              </tr>
                            </table>
                          </div>
                        </div>
                      </td>
                    </ng-container>

                    <tr
                      mat-header-row
                      *matHeaderRowDef="columnsToDisplayWithExpand"
                    ></tr>
                    <tr
                      mat-row
                      *matRowDef="
                        let element;
                        columns: columnsToDisplayWithExpand
                      "
                      class="example-element-row"
                      [class.example-expanded-row]="expandedElement === element"
                      (click)="
                        expandedElement =
                          expandedElement === element ? null : element
                      "
                    ></tr>
                    <tr
                      mat-row
                      *matRowDef="let row; columns: ['expandedDetail']"
                      class="example-detail-row"
                    ></tr>
                  </table>

                  <mat-paginator
                    class="mat-elevation-z8"
                    #paginator
                    [pageSize]="50"
                    showFirstLastButtons
                    [pageSizeOptions]="[20, 50, 100]"
                  >
                  </mat-paginator>
                </div>
              </mat-tab>
            </mat-tab-group>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
